import sys
import time
import os
import requests # Replaces urllib2
from bs4 import BeautifulSoup

   # 1. Le logo en texte ASCII généré (exemple)
logo_ascii = """
                                                                                   ^                      
                                                                                 J@@M                     
                                                                        ^         @@@@^                   
                                                                     ;@@@>         J@@@                   
                                                                      ;@@@J      ;j j@@@}                 
                                                                       ^@@@O  ^J@@@@^;@@@}                
                                                                   >@@@; @@@@^;@@@@@> ;@@@O               
                                                                >j _@@@@j p@@@^;@|      @@@>              
                                                              }@@@@  @@@@j J@@@>                          
                                                          ^a@@ _@@@@;_@@@@a }@@@>                         
                                                       ^} v@@@@^;@@@@@@@@@@@ >@@@v                        
                                                     |@@@@ ^@@@@J@@@@@@@@@@@@;^@@@J                       
                                                  J@M }@@@@ _@@@@@@@@@@@@@@j    @@j                       
                                               ; v@@@@ >@@@@@@@@@@@@@@@@j                                 
                                            ^@@@@ ;@@@@v@@@@@@@@@@@@@j^                                   
                                            a@@@@@ >@@@@@@@@@@@@@@a                                       
                                            |@@@@@@@@@@@@@@@@@@J                                          
                                          |a ;@@@@@@@@@@@@@@a;                                            
                                         @@@@ ;@@@@@@@@@@@;                                               
                                        |@@@@@> @@@@@@@>                                                  
                                     }@@@pO@MJ   >pp_                                                     
                                  ;@@@a                                                                   
                               ;@@@p;                                                                     
                            >p@@M>                                                                        
                           }@@>      
"""

# 2. Nettoyer l'écran avant l'affichage (optionnel, mais propre)
# 'cls' pour Windows, 'clear' pour Linux/macOS
os.system('cls' if os.name == 'nt' else 'clear')

# 3. Afficher le logo
print(logo_ascii)

# 4. Ajouter une petite pause avant le reste du script (optionnel)
time.sleep(2)

# --- Color Constants ---
RED = "\033[91m"
GREEN = "\033[92m"
YELLOW = "\033[93m"
NORMAL = "\033[0m"

# --- Simplified Google Search Function ---
# Replacing 'from googlesearch import search' with a standard approach
try:
    # Use 'google-search' library if available
    from google_search import search as g_search
    
    def search_google(dork):
        """Uses the google-search library to find URLs."""
        # Limit results to 10 for demonstration
        return [result['link'] for result in g_search(dork, num_results=10)]
except ImportError:
    # Fallback function if 'google-search' is not installed
    def search_google(dork):
        print(f"{YELLOW}[!] 'google-search' library not found. Returning a test URL.{NORMAL}")
        # In a real script, you should use the official API or a better library.
        return ["http://example.com/test.php?id=1"]


def credit():
    """Prints the script credits."""
    print(f'''
    {YELLOW}
    SQL vulnerability finder 
    https://github.com/foxstreiker/
    {NORMAL}
    ''')

def word_err(soup):
    """
    Checks for SQL error keywords in the HTML content.
    
    Args:
        soup (BeautifulSoup): BeautifulSoup object of the HTML content.
        
    Returns:
        int: Count of keywords found. Returns 0 if none.
    """
    # Keywords indicating a potential SQL error or warning
    words = ['Warning', 'Fatal Error', 'Mysql', 'mysql', 'SQL', 'MySQL', 'syntax', 'query']
    
    # Convert BeautifulSoup object to string for search, ignoring case
    content = str(soup).lower()
    
    # Count how many keywords are present
    count = sum(1 for word in words if word.lower() in content)
    
    return count

def vuln_test(url):
    """
    Tests a URL for a simple SQL injection vulnerability (Error-based/Boolean-based).
    
    Args:
        url (str): The URL to test.
    """
    
    # Define a timeout to prevent hanging
    timeout = 10
    
    try:
        # 1. Initial Request (without quote)
        response = requests.get(url, timeout=timeout)
        # Use 'html.parser' for parsing
        soup = BeautifulSoup(response.content, 'html.parser') 
        
        # 2. Request with single quote (') appended
        url2 = url + "'"
        response2 = requests.get(url2, timeout=timeout)
        soup2 = BeautifulSoup(response2.content, 'html.parser')
        
        # Vulnerability test is based on two criteria:
        # a) The response with the quote is different from the response without.
        # b) The response with the quote contains SQL error keywords.
        
        # Compare the rendered text, not the raw BeautifulSoup objects.
        if soup.get_text() != soup2.get_text():
            if word_err(soup2) > 0: # Must be > 0 errors
                print(f"\n[{GREEN}*{NORMAL}] Possible SQL vulnerability (Error-based/Difference) => {url2}")
            else:
                 # If different but no error, might be Blind SQL or difference in content
                 print(f"\n[{YELLOW}?{NORMAL}] Possible SQL vulnerability (Boolean-based/Difference detected) => {url2}")
        
    except requests.exceptions.HTTPError as e:
        # Handles HTTP status errors (4xx, 5xx)
        print(f"[{RED}E{NORMAL}] HTTP Error on {url}: {e}")
    except requests.exceptions.RequestException as e:
        # Handles all other request errors (timeout, DNS, connection)
        # print(f"[{RED}E{NORMAL}] Request Error on {url}: {e}")
        pass # Ignored for connection/timeout errors

# --- Main Logic ---

credit()

# Use 'input()' instead of 'raw_input' (Python 3)
try:
    dork = input(f"Enter a dork (ex: 'inurl:index.php?id=') => ")
except EOFError:
    print("\nExiting.")
    sys.exit()

if not dork:
    print(f"[{RED}E{NORMAL}] No dork provided. Exiting.")
    sys.exit()

print(f"\n[{GREEN}i{NORMAL}] Searching Google with dork: '{dork}'...")

try:
    # Use the defined search function
    url_list = search_google(dork)
    
    if not url_list:
        print(f"[{YELLOW}!{NORMAL}] No results found for the dork.")
        sys.exit()
    
    print(f"[{GREEN}i{NORMAL}] Starting vulnerability test on {len(url_list)} URL(s)...")
    
    for url in url_list:
        vuln_test(url)
        
    print(f"\n[{GREEN}i{NORMAL}] Test complete.")
        
# This error handling depends on the 'search_google' function used
except Exception as e:
    print(f"{RED}Google ban or Search Error: {e}{NORMAL} (You might need to restart your connection or use an API).")